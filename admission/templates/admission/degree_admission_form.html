﻿{% extends 'layout.html' %}
{% block title %}B.com Application Form{% endblock %}

{% block content %}

<style>
    /* Hide print-only sections on screen */
    .print-only {
        display: none;
    }

    /*    hide while-printing*/
    .footer, #main-footer {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
    }

    @media print {
        body * {
            visibility: hidden;
        }

        #print-area, #print-area * {
            visibility: visible;
        }

        #print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .no-print, footer, #main-footer {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
        }

        input, select, textarea {
            border: none;
            background: transparent;
            box-shadow: none;
            color: #000;
        }

            input[type=checkbox], input[type=radio] {
                transform: scale(1.2);
            }

        .form-control {
            padding: 0;
            margin: 0;
        }

        .form-group {
            page-break-inside: avoid;
            break-inside: avoid;
            margin-bottom: 0px;
        }

        .form-label {
            font-weight: bold;
        }

        hr {
            border-color: #000 !important;
        }

        table {
            width: 100% !important;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #000 !important;
            padding: 4px !important;
            font-size: 12px;
        }

        h1, h2, h3, h4, h5, h6 {
            page-break-after: avoid;
            page-break-inside: avoid;
        }

        /*.section-break {
            page-break-before: always;
            break-before: page;
        }*/

        /* Show photo section only in print */
        .print-only {
            display: block !important;
        }

        #uploadBox input {
            display: none !important;
        }

        #photoPreview {
            display: block !important;
            max-height: 150px !important;
            margin-top: 12px;
        }
    }
</style>

<style>
    .marks-summary-cell {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 4px;
    }

    .small-box {
        background-color: #fff;
        padding: 0px 0px;
        font-size: 13px;
        min-width: 35px;
        text-align: center;
    }

    .divider {
        font-weight: bold;
        font-size: 14px;
    }

    #academicYearDropdown {
        font-size: 18px;
        border: none;
        background: none;
        appearance: none;
        -webkit-appearance: none;
        font-weight: bold;
        color: #000;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dropdown = document.getElementById('academicYearDropdown');
        const currentYear = new Date().getFullYear();

        // Generate academic years from current year to next 5 years
        for (let i = 0; i < 6; i++) {
            const startYear = currentYear + i;
            const endYear = startYear + 1;
            const option = document.createElement('option');
            option.value = `${startYear}-${endYear}`;
            option.textContent = `${startYear}-${endYear}`;
            dropdown.appendChild(option);
        }

        // Optional: Set the current academic year as selected
        dropdown.value = `${currentYear}-${currentYear + 1}`;
    });
</script>

<div id="print-area">
    <div class="container mt-5">
        <div class="form-card mx-auto" style="max-width: 800px; position: relative; display: flex; flex-direction: column; margin-left: 97px;">

            <!-- Logo & Heading -->
            <div class="logo-container">
                <img src="https://i.postimg.cc/fbZjQX3j/Untitled-Project.jpg" alt="College Logo">
                
            </div>

            <h2 style="text-align: center; font-size: 20px;">
    Application for the admission of BCOM program for the academic year 
    <select id="academicYearDropdown" name="academic_year" style="font-size: 18px; border: none; background: none;">
        <!-- Options will be populated by JavaScript -->
    </select>
</h2>
            <!-- Upload Photo -->
            <div style=" margin-top: 20px;" class="photo-section print-only">
                <div class="photo-upload" id="uploadBox">
                    <!--{{ form.photo }}-->
                    <label>l>
Photo
                    >
                    </label>
                    l>
                    >

                    <!--<img id="photoPreview" src="" alt="Photo " style="max-height: 150px; margin-top: 10px;" />-->
                </div>
            </div>

            <!--<div class="photo-section print-only">
            <div class="photo-upload" id="uploadBox">-->
            <!--{{ form.photo }}-->
            <!--<label>Photo</label>-->
            <!--<img id="photoPreview" src="" alt="Photo " style="max-height: 150px; margin-top: 10px;" />-->
            <!--</div>=
            </div>-->


        <form method="POST" enctype="multipart/form-data" style="flex: 1; display: flex; flex-direction: column;">
            {% csrf_token %}

            <div class="form-group">
                <label class="form-label">Application Number</label>
                {% if view_mode or edit_mode %}
                {{ form.admission_no }}
                {% else %}
                <input type="text" class="form-control bg-light" value="{{ next_admission_no }}" readonly>
                {{ form.admission_no.as_hidden }}
                {% endif %}
            </div>
            <div class="form-group">
                <label class="form-label">Application Date:</label>
                {{ form.admission_date }}
            </div>
            <div class="form-group">
                <label class="form-label">Enquiry Number:</label>
                <input type="text" id="id_enquiry_no" name="enquiry_no" maxlength="20" autocomplete="off" class="form-control" value="{{ form.enquiry_no.value|default:'' }}" {% if view_mode %}readonly disabled{% endif %} />

                <small id="enquiry-error" style="color: red; display: none;">Enquiry number not found or not for PU</small>
            </div>
            <!-- PERSONAL DETAILS -->



            <hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

            <h4 class="mt-4 mb-3 text-uppercase text-primary"
                style="text-align: center; margin-top: -5px; margin-bottom: 11px;">
                Student Details
            </h4>

            <div class="form-group">
                <label for="id_student_name" style="font-size: 12px; font-weight: 500; color: #333;">
                    Name of the Student as entered in SSLC marks card
                </label>
                {{ form.student_name }}
            </div>

            <div class="form-group">
                <label class="form-label">Date of Birth</label>
                {{ form.dob }}
            </div>

            <div class="form-group">
                <label for="id_gender" style="font-size: 12px; font-weight: 500; color: #333;">
                    Gender
                </label>
                {{ form.gender }}
            </div>

            <div class="form-group">
                <label for="id_birthplace" style="font-size: 12px; font-weight: 500; color: #333;">
                    Place of Birth
                </label>
                {{ form.birthplace }}
            </div>

            <div class="form-group">
                <label class="form-label">Nationality</label>
                {{ form.nationality }}
            </div>

            <div class="form-group">
                <label class="form-label">Religion</label>
                {{ form.religion }}
            </div>

            <div class="form-group">
                <label class="form-label">Caste</label>
                {{ form.caste }}
                {% if form.caste.errors %}
                <div class="text-danger small">{{ form.caste.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label">Sub Caste</label>
                {{ form.sub_caste }}
                {% if form.sub_caste.errors %}
                <div class="text-danger small">{{ form.sub_caste.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label">Category</label>
                {{ form.category }}
                {% if form.category.errors %}
                <div class="text-danger small">{{ form.category.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label class="form-label">Student Mobile No</label>
                {{ form.student_phone_no }}
                {% if form.student_phone_no.errors %}
                <div class="text-danger small">{{ form.student_phone_no.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_student_aadhar_no" style="font-size: 12px; font-weight: 500;">
                    Student Aadhar No
                </label>
                {{ form.student_aadhar_no }}
                <div id="error_id_student_aadhar_no" class="error-message"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Student e-Mail ID</label>
                {{ form.student_email }}
                <div id="error_id_student_email" class="error-message"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Blood Group</label>
                {{ form.blood_group }}
            </div>

            <div class="form-group">
                <label for="id_emergency_contact" style="font-size: 12px; font-weight: 500; color: #333;">
                    Emergency Contact No <span style="color: red;">*</span>
                </label>
                {{ form.emergency_contact }}
                <div id="error_id_emergency_contact" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_emergency_contact_name" style="font-size: 12px; font-weight: 500; color: #333;">
                    Emergency Contact Person Name
                </label>
                {{ form.emergency_contact_name }}
            </div>

            <div class="form-group">
                <label for="id_emergency_contact_relation" style="font-size: 12px; font-weight: 500; color: #333;">
                    Emergency Contact Person's relationship with Student
                </label>
                {{ form.emergency_contact_relation }}
            </div>




            <hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

            <h4 class="mt-4 mb-3 text-uppercase text-primary" style=" text-align: center; margin-top: -5px; margin-bottom: 10px;">Parent Details</h4>

            <div class="form-group">
                <label class="form-label">Name of the Father</label>
                {{ form.father_name }}
                {% if form.father_name.errors %}
                <div class="text-danger">{{ form.father_name.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_father_mobile_no" style="font-size: 12px; font-weight: 500;">
                    Father Mobile No
                </label>
                {{ form.father_mobile_no }}
                <div id="error_id_father_mobile_no" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_aadhar_no" style="font-size: 12px; font-weight: 500; color: #333;">
                    Father Aadhar No
                </label>
                {{ form.aadhar_no }}
                <div id="error_id_aadhar_no" class="error-message"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Father e-Mail ID</label>
                {{ form.father_email }}
                <div id="error_id_father_email" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_parent_mobile_no" style="font-size: 12px; font-weight: 500; color: #333;">
                    Father Occupation
                </label>
                {{ form.father_occupation }}
            </div>

            <div class="form-group">
                <label class="form-label">Father Annual Income</label>
                {{ form.annual_income }}
            </div>

            <div class="form-group">
                <label class="form-label">Name of the Mother</label>
                {{ form.mother_name }}
                {% if form.mother_name.errors %}
                <div class="text-danger small">{{ form.mother_name.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_mother_phone_no" style="font-size: 12px; font-weight: 500; color: #333;">
                    Mother Mobile No
                </label>
                {{ form.mother_phone_no }}
                <div id="error_id_mother_phone_no" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_mother_aadhar_no" style="font-size: 12px; font-weight: 500; color: #333;">
                    Mother Aadhar No
                </label>
                {{ form.mother_aadhar_no }}
                <div id="error_id_mother_aadhar_no" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_mother_email" class="form-label">Mother e-Mail ID</label>
                {{ form.mother_email }}
                <div id="error_id_mother_email" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="id_parent_mobile_no" style="font-size: 12px; font-weight: 500; color: #333;">
                    Mother Occupation
                </label>
                {{ form.mother_occupation }}
            </div>

            <div class="form-group">
                <label class="form-label">Mother Annual Income</label>
                {{ form.mother_annual_income }}
            </div>

            <div class="form-group">
                <label class="form-label">Name of the Guardian</label>
                {{ form.guardian_name }}
            </div>

            <div class="form-group">
                <label class="form-label" for="primary_guardian">Select the parent for the parent login</label>
                {{ form.primary_guardian }}
            </div>

            <div class="form-group" id="guardian_fields" style="display: none;">
                <label class="form-label" for="guardian_email">Guardian Email</label>
                {{ form.guardian_email }}

                <label class="form-label mt-2" for="guardian_phone_no">Guardian Phone Number</label>
                {{ form.guardian_phone_no }}
            </div>

            <div class="form-group">
                <label class="form-label">Address of the Guardian</label>
                {{ form.guardian_address }}
            </div>

            <div class="form-group">
                <label class="form-label">Total Annual Income</label>
                {{ form.total_annual_income }}
            </div>



            <hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

            <h4 class="mt-4 mb-3 text-uppercase text-primary" 
    style="text-align: center; margin-top: -5px; margin-bottom: 10px;">
  Address Details
</h4>

<div class="form-group">
  <label class="form-label">Local Address</label>
  {{ form.current_address }}
  {% if form.current_address.errors %}
    <div class="text-danger small">{{ form.current_address.errors.0 }}</div>
  {% endif %}
</div>

<div class="form-group">
  <label for="id_permanent_address" style="font-size: 12px; font-weight: 500; color: #333;">
    Permanent Address
  </label>
  {{ form.permanent_address }}
</div>

<div class="form-group">
  <label class="form-label">Taluk</label>
  {{ form.city }}
</div>

<div class="form-group">
  <label for="id_district" style="font-size: 12px; font-weight: 500; color: #333;">
    District
  </label>
  {{ form.district }}
</div>

<div class="form-group">
  <label class="form-label">State</label>
  {{ form.state }}
</div>

<div class="form-group">
  <label class="form-label">Country</label>
  {{ form.country }}
</div>

<hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

<h4 class="mt-4 mb-3 text-uppercase text-primary" 
    style="text-align: center; margin-top: -5px; margin-bottom: 10px;">
  Educational Details of Previous Year
</h4>

<div class="form-group">
  <label class="form-label">SATS Number</label>
  <input type="text" name="sats_number" class="form-control bg-light" placeholder="Enter SATS Number" />
</div>

<div class="form-group">
  <label class="form-label">Name of the School last Studied</label>
  {{ form.college_last_attended }}
</div>

<div class="form-group">
  <label class="form-label">Address of the School last Studied</label>
  {{ form.college_addresslaststudied }}
</div>

<div class="form-group">
  <label class="form-label">SSLC Registration No</label>
  {{ form.sslc_reg_no }}
</div>

<div class="form-group">
  <label class="form-label">SSLC Percentage</label>
  {{ form.sslc_percentage }}
</div>

<div class="form-group">
  <label class="form-label">Year of Passing (MM-YYYY)</label>
  {{ form.year_of_passing }}
</div>

<div class="form-group">
  <label class="form-label">PU College Name</label>
  {{ form.pu_college_name }}
</div>

<div class="form-group">
  <label class="form-label">PU Register No</label>
  {{ form.register_no_course }}
</div>

<div class="form-group">
  <label class="form-label">Month & Year Passed</label>
  {{ form.month_year_passed }}
</div>

<div class="form-group">
  <label class="form-label">Medium</label>
  {{ form.medium }}
</div>

<div class="form-group">
  <label class="form-label">First Language</label>
  {{ form.first_language }}
</div>

<div class="form-group">
  <label class="form-label">Second Language</label>
  {{ form.second_language }}
</div>

<div class="form-group">
  <label for="id_education_boards" style="font-size: 12px; font-weight: 500; color: #333;">
    Education Boards Attended
  </label>
  {{ form.education_boards }}
</div>

<div class="form-group">
  <label class="form-label">Conversion Fee</label>
  {{ form.converstion_fee }}
</div>

<hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

<h4 class="mt-4 mb-3 text-uppercase text-primary" 
    style="text-align: center; margin-top: -5px; margin-bottom: 10px;">
  Admission Details
</h4>

<div class="form-group">
  <label for="id_course_type" class="form-label">Program Type</label>
  <select name="course_type" id="id_course_type" class="form-select"
          {% if view_mode %}disabled{% endif %}>
    <option value="">Select Course Type</option>
    {% for ct in form.fields.course_type.queryset %}
      <option value="{{ ct.id }}"
        {% if form.initial.course_type and ct.id == form.initial.course_type %}
          selected
        {% endif %}>
        {{ ct.name }}
      </option>
    {% endfor %}
  </select>
</div>

<div class="form-group mt-3">
  <label for="id_course" class="form-label">Course</label>
  <select name="course" id="id_course" class="form-select"
          {% if view_mode %}disabled{% endif %}>
    <option value="">Select Course</option>
    {# Pre-fill course if editing #}
    {% if form.initial.course %}
      {% for course in form.fields.course.queryset %}
        <option value="{{ course.id }}"
          {% if course.id == form.initial.course %}
            selected
          {% endif %}>
          {{ course.name }}
        </option>
      {% endfor %}
    {% endif %}
  </select>
</div>


<div class="form-group">
  <label class="form-label">Medium of Instruction in BCOM Course</label>
  {{ form.medium_of_instruction }}
</div>

<div class="form-group">
  <label class="form-label">Quota</label>
  {{ form.quota_type }}
</div>




            <hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

            <h4 class="mt-4 mb-3 text-uppercase text-primary" style="text-align: center; margin-bottom: 10px;">Undertaking Details</h4>

            <!-- Declaration Container -->
            <div class="form-group" style="grid-column: 1 / -1;">

                <!-- Parent's Declaration Section -->
                <h5 class="mt-4">Parent's/Guardian's Undertaking</h5>

                <p style="font-style: normal; color: #333; font-size: 10px; ">
                    I, Mr./Mrs./Ms.
                    <span {% if view_mode %}contenteditable="false" {% else %}contenteditable="true" {% endif %} style="border-bottom: 1px dotted #333; min-width: 150px; display: inline-block;"></span>,
                    Parent/Guardian of Master/Kumari
                    <span id="studentNameInsert" {% if view_mode %}contenteditable="false" {% else %}contenteditable="true" {% endif %} style="border-bottom: 1px dotted #333; min-width: 150px; display: inline-block;"></span>,
                    hereby agree to take full responsibility for my ward in all academic, co-curricular, and disciplinary matters during the course of study at the institution.
                </p>

                <p style="font-style: normal; color: #333; font-size: 10px; ">
                    I permit my ward to participate in co-curricular and extra-curricular activities organized by the institution. I understand necessary safety measures will be ensured and I support their involvement in such activities.
                    If my ward has participated at Taluk, District, or State level events, I will submit a copy of the supporting documents in the documents section below.
                </p>


                <!-- Parent Date, Place, Signature -->
                <div class="form-grid mt-3">
                    <div class="form-group">
                        <label class="form-label">Date </label>
                        {{ form.parent_declaration_date }}
                    </div>
                    <div class="form-group">
                        <label class="form-label">Place </label>
                        {{ form.parent_declaration_place }}
                    </div>
                    <div class="form-group mt-4" style="display: flex; justify-content: flex-end;">
                        <div style="width: 200px; display: flex; flex-direction: column; align-items: center;">
                            <div style="width: 100%; border-bottom: 1px solid #000; height: 30px;"></div>
                            <small>Father/Mother/Guardian Signature</small>
                        </div>
                    </div>
                </div>
                <div class="mt-4" style="font-size: 15px; line-height: 1.6; color: #333;">

                    <!-- Student's Declaration Section -->
                    <!--<h5 class="mt-4" style="text-align: center; margin-bottom: 10px; margin-top: 15px;">Student's Undertaking</h5>

                    <p style="font-style: normal; color: #333; font-size: 10px; ">
                        I hereby declare that I will abide by all the rules and regulations of the University, the State Government, and the college regarding my admission, attendance, conduct, and academics. I understand that my admission is subject to eligibility verification and submission of all original documents as prescribed.
                    </p>

                    <p style="font-style: normal; color: #333; font-size: 10px; ">
                        I agree to follow the fee payment policies of the institution. I acknowledge that fee payment is my responsibility and that delayed payments may attract fines. I understand that fees once paid are non-refundable.
                    </p>

                    <p style="font-style: normal; color: #333; font-size: 10px; ">
                        I also undertake not to engage in any form of ragging, eve-teasing, substance abuse, or any anti-social activity.
                    </p>

                    <p style="font-style: normal; color: #333; font-size: 10px; ">
                        I accept that failure to adhere to these rules will result in disciplinary action by the institution.
                    </p>

                    <p style="font-style: normal; color: #333; font-size: 10px; ">
                        I agree to comply with the prescribed dress code and maintain discipline throughout my course of study.
                    </p>-->

                    <!-- Student Date, Place, Signature -->
                    <!--<div class="form-grid mt-3">
                        <div class="form-group">
                            <label class="form-label required">Date <span class="text-danger"></span></label>
                            {{ form.student_declaration_date }}
                            {% if form.student_declaration_date.errors %}
                            <div class="text-danger small">{{ form.student_declaration_date.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Place <span class="text-danger"></span></label>
                            {{ form.student_declaration_place }}
                            {% if form.student_declaration_place.errors %}
                            <div class="text-danger small">{{ form.student_declaration_place.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="form-group mt-4" style="display: flex; justify-content: flex-end;">
                            <div style="width: 200px; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; border-bottom: 1px solid #000; height: 30px;"></div>
                                <small>Student's Signature</small>
                            </div>
                        </div>
                    </div>-->

                </div>


            </div>

            <!-- Full-width horizontal line OUTSIDE the grid -->
            <hr class="mt-4" style="border: 1px solid #000; width: 100%; margin: 2rem auto;" />

            <h4 class="mt-4 mb-3 text-uppercase text-primary" style=" text-align: center; margin-top: -5px; margin-bottom: 10px;">For Office Use Only</h4>


            <div class="form-group" style="grid-column: 1/-1;">
                <label class="form-label">Program Choosen</label>
                {{ form.admitted_to }}
            </div>

            <!-- REQUIRED DOCUMENTS SECTION -->
            <h4 class="mt-4 mb-3 text-uppercase text-primary" style=" text-align: center; margin-top: 15px; margin-bottom: 8px;">Documents Required</h4>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_aadhar }}
                    Aadhar Card
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_marks_card }}
                    Marks Card (Grade 10 CBSE, ICSE, IGCSE)
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_caste_certificate }}
                    Caste Certificate
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_income_certificate }}
                    Income Certificate
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_transfer }}
                    Transfer Certificate
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_migration }}
                    Migration/Eligibility Certificate
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_study }}
                    Study Certificate
                </label>
            </div>
            <div class="form-group checkbox-inline">
                <label class="form-label">
                    {{ form.doc_participation_documents }}
                    Participation Documents
                </label>
            </div>


            <!-- OFFICE USE ONLY -->
            <div class="form-group" style="grid-column: 1/-1;">
                <!--<h4 class="mt-4 mb-3" style=" text-align: center; margin-top: 15px; margin-bottom: 8px;">Fees Details</h4>--> <!-- Heading Added -->
                <!--<div class="form-grid">
                    {# Replace the Receipt No section with this block in your template #}
                    <div class="form-group">-->
                        <!--<div class="mb-3">
                    <label for="{{ form.academic_year.id_for_label }}" class="form-label">Academic Year</label>
                    {{ form.academic_year }}
                    {% if form.academic_year.errors %}
                    <div class="text-danger">{{ form.academic_year.errors }}</div>
                    {% endif %}
                </div>-->
                        <!--<label class="form-label">Receipt No</label>

                        {% if form.instance.pk %}  {# Editing: allow editing receipt number #}
                        {{ form.receipt_no }}
                        {% else %}  {# Creating: show readonly input with next_receipt_no #}
                        <input type="text" class="form-control bg-light" name="receipt_no" id="id_receipt_no"
                               value="{{ next_receipt_no }}" readonly>
                        {{ form.receipt_no.as_hidden }}
                        {% endif %}

                        {% if last_receipt_no %}
                        <small class="text-muted">Previous receipt no: {{ last_receipt_no }}</small>
                        {% endif %}

                        <div class="form-group">
                            <label class="form-label">Receipt Date</label>
                            {{ form.receipt_date }}
                        </div>-->



                        <!--<div class="form-group">
                    <label class="form-label">Caution Deposit Fee*</label>
                    {{ form.tuition_advance_amount }}
                </div>-->
                        <!--<div class="form-group">
                            <label class="form-label">Transcation ID/Reference No</label>
                            {{ form.utr_no }}
                        </div>


                        <div class="form-group">
                            <label class="form-label" for="id_application_fee">Application Fee:</label>
                            <input type="text" name="application_fee" id="id_application_fee" class="form-control" readonly>
                        </div>-->
                        <!--<div class="form-group">
                    <label class="form-label" for="id_tuition_fee">Tuition Fee:</label>
                    <input type="text" name="tuition_fee" id="id_tuition_fee" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label" for="id_books_fee">Books Fee:</label>
                    <input type="text" name="books_fee" id="id_books_fee" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label" for="id_uniform_fee">Uniform Fee:</label>
                    <input type="text" name="uniform_fee" id="id_uniform_fee" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label" for="id_transport_fees">Transport Fee:</label>
                    <input type="text" name="transport_fees" id="id_transport_fees" class="form-control" readonly>
                </div>-->

                        <!--<div class="form-group">
                            <label class="form-label required">Payment Mode <span class="text-danger"></span></label>
                            {{ form.payment_mode }}
                            {% if form.payment_mode.errors %}
                            <div class="text-danger small">{{ form.payment_mode.errors.0 }}</div>
                            {% endif %}
                        </div>-->

                        <!-- QR Code Display Section -->
                        <!--<div id="qr-code-section" class="mt-3" style="display: none;">
                            <label>Scan to Pay (QR Code)</label><br>
                            <div id="qrcode" class="border p-2"></div>
                        </div>-->

                        <!-- TRANSPORT & HOSTEL -->
                        <!--{% if view_mode %}
                <div class="form-group">
                    <label class="form-label">Hostel Required:</label>
                    {{ form.hostel_required }}
                </div>
                <div class="form-group">
                    <label class="form-label">Enter Hostel Amount</label>
                    {{ form.hostel_amount }}
                </div>
                <div class="form-group">
                    <label class="form-label">Transport:</label>
                    {{ form.wants_transport }}
                </div>
                <div class="form-group">
                    <label class="form-label">Enter Transport Amount</label>
                    {{ form.transport_amount }}
                </div>
                <div class="form-group">
                    <label class="form-label">Transport Route/Details</label>
                    {{ form.transport }}
                </div>
                <div class="form-group">
                    <label class="form-label">Scholarship:</label>
                    {{ form.has_scholarship }}
                </div>
                <div class="form-group">
                    <label class="form-label">Enter Scholarship Amount</label>
                    {{ form.scholarship_amount }}
                </div>
                {% else %}-->
                        <!-- Hostel Required Yes/No -->
                        <!--<div class="form-group checkbox-inline" style="grid-column: 1 / 2;">
                    <label class="form-label me-2">Hostel Required:</label>
                    <input type="radio" id="hostel_yes" name="hostel_required" value="yes" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="hostel_yes" class="me-3" style="margin-right:10px;">Yes</label>
                    <input type="radio" id="hostel_no" name="hostel_required" value="no" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="hostel_no">No</label>
                </div>
                <div class="form-group" id="hostel_amount_group" style="display: none;">
                    <label class="form-label">Enter Hostel Amount</label>
                    <input type="text" name="hostel_amount" class="form-control" placeholder="Enter amount" />
                </div>

                <div class="form-group checkbox-inline" style="grid-column: 1 / 2;">
                    <label class="form-label me-2">Transport:</label>
                    <input type="radio" id="transport_yes" name="wants_transport" value="yes" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="transport_yes" class="me-3" style="margin-right:10px;">Yes</label>
                    <input type="radio" id="transport_no" name="wants_transport" value="no" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="transport_no">No</label>
                </div>
                <div class="form-group" id="transport_amount_group" style="display: none;">
                    <label class="form-label">Enter Transport Amount</label>
                    <input type="text" name="transport_amount" class="form-control" placeholder="Enter amount" />
                </div>
                <div class="form-group" id="transport_dropdown_div" style="display: none;">
                    <label class="form-label">Transport Route/Details</label>
                    {{ form.transport }}
                </div>-->
                        <!-- SCHOLARSHIP SECTION -->
                        <!--<div class="form-group checkbox-inline" style="grid-column: 1 / 2;">
                    <label class="form-label me-2">Scholarship:</label>
                    <input type="radio" id="scholarship_yes" name="has_scholarship" value="yes" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="scholarship_yes" class="me-3" style="margin-right:10px;">Yes</label>
                    <input type="radio" id="scholarship_no" name="has_scholarship" value="no" class="form-check-input me-1" style="margin-left:10px;">
                    <label for="scholarship_no">No</label>
                </div>
                <div class="form-group" id="scholarship_amount_group" style="display: none;">
                    <label class="form-label">Enter Scholarship Amount</label>
                    <input type="text" name="scholarship_amount" class="form-control" placeholder="Enter amount" />
                </div>
                {% endif %}-->
                        <!-- Accountant's Signature -->
                        <!--<div class="form-group" style="grid-column: 1 / -1; display: flex; justify-content: flex-end;">
                            <div style="width: 200px; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; border-bottom: 1px solid #000; height: 30px;"></div>
                                <small>Accountant's Signature</small>
                            </div>
                        </div>

                        <div class="form-group" style="grid-column: 1 / -1; display: flex; justify-content: flex-end;">
                            <div style="width: 200px; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; border-bottom: 1px solid #000; height: 30px;"></div>
                                <small>Chairman Signature with Seal</small>
                            </div>
                        </div>-->


                        <!-- Dean & Director's Signature with Seal -->
                        <div class="form-group" style="grid-column: 1 / -1; display: flex; justify-content: flex-end;">
                            <div style="width: 200px; display: flex; flex-direction: column; align-items: center;">
                                <div style="width: 100%; border-bottom: 1px solid #000; height: 30px;"></div>
                                <small>Dean & Director's Signature with seal</small>
                            </div>
                        </div>
                        <!--<div class="form-group mt-4" style="display: flex; justify-content: space-between; gap: 40px;">
                <div style="flex: 1;text-align: center;
                                       margin-top: 15px;
                                       margin-left: 348px; ">
                    <div style=" border-bottom: 1px solid #000; width: 54%; height: 0px; margin-top: -51px; margin-left: 198px;">Chairman Signature with Seal</div>
                </div>-->
                        <!-- Declaration by the student -->
                        <!--</div>-->


                        <div class="mt-4" style=" display: flex; justify-content: space-between; width: 100%;">
                            <button type="{% if view_mode %}button{% else %}submit{% endif %}"
                                    class="btn btn-primary btn-lg no-print"
                                    {% if view_mode %}onclick="window.history.back();" {% endif %}>
                                {% if view_mode %}
                                Back
                                {% elif edit_mode %}
                                Update
                                {% else %}
                                Submit
                                {% endif %}
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm no-print" style="background-color: #800000; color: white;" onclick="window.print();">
                                <i class="fa fa-print"></i> Print
                            </button>
                        </div>


                        {% if form_submission_success %}
                        <div class="alert alert-success text-center mt-3" role="alert">
                            Admission form has been successfully submitted!
                        </div>
                        {% endif %}
                        {% if form.errors %}
                        <div class="alert alert-danger text-center mt-3" role="alert">
                            Please correct the errors in the form.
                            {{ form.errors }}
                        </div>
                        {% endif %}

                    </div> <!-- End form-grid -->
                </div>
            </div>
        </form>
        </div>
    </div>


</div> <!-- End form-card -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const dropdown = document.getElementById("id_primary_guardian");  // Django auto-prefixes "id_"
        const guardianFields = document.getElementById("guardian_fields");

        function toggleGuardianFields() {
            if (dropdown.value === "guardian") {
                guardianFields.style.display = "block";
            } else {
                guardianFields.style.display = "none";
            }
        }

        dropdown.addEventListener("change", toggleGuardianFields);
        toggleGuardianFields();  // run on page load
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var courseSelect = document.getElementById('id_course');
        var admittedToSelect = document.getElementById('id_admitted_to');

        if (courseSelect && admittedToSelect) {
            // Sync on course select change
            courseSelect.addEventListener('change', function () {
                admittedToSelect.value = courseSelect.value;
            });

            // Sync on page load (optional)
            if (courseSelect.value) {
                admittedToSelect.value = courseSelect.value;
            }
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll('input[name="education_boards"]');
        checkboxes.forEach(cb => {
            cb.addEventListener("change", function () {
                if (this.checked) {
                    checkboxes.forEach(other => {
                        if (other !== this) {
                            other.checked = false;
                        }
                    });
                }
            });
        });
    });
</script>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        const studentNameInput = document.getElementById('id_student_name');

        studentNameInput.addEventListener('input', function () {
            // Remove invalid characters and convert to uppercase
            this.value = this.value.toUpperCase().replace(/[^A-Z\s]/g, '');
        });
    });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {

    function loadCourses(courseTypeId, selectedCourseId = null) {
        if (!courseTypeId) {
            $("#id_course").html('<option value="">Select Course</option>');
            return;
        }

        $.ajax({
            url: "{% url 'ajax_load_courses' %}",
            data: { 'course_type': courseTypeId },
            success: function (data) {
                $("#id_course").html('<option value="">Select Course</option>');
                data.forEach(function (course) {
                    const selected = selectedCourseId == course.id ? "selected" : "";
                    $("#id_course").append(`<option value="${course.id}" ${selected}>${course.name}</option>`);
                });
            }
        });
    }

    // 🔁 When Program Type changes → load Courses dynamically
    $('#id_course_type').change(function () {
        const courseTypeId = $(this).val();
        loadCourses(courseTypeId);
    });

    // 🟡 Preload courses when editing (or adding with preset type)
    /* {% if not view_mode %} */
    const initialCourseType = $('#id_course_type').val();
    const selectedCourse = "{{ form.initial.course|default:'' }}";
    if (initialCourseType) {
        loadCourses(initialCourseType, selectedCourse);
    }
    /* {% endif %} */

});
</script>


{% if add_mode or edit_mode %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const ROWS = 6;

        function computeRow(i) {
            // Use Django's default IDs for input fields
            let totalInput = document.getElementById(`id_max_marks${i}`);
            let marksInput = document.getElementById(`id_marks_obtained${i}`);
            let percentInput = document.getElementById(`id_total_marks_percentage${i}`);

            let total = totalInput ? parseFloat(totalInput.value) : 0;
            if (isNaN(total) || total <= 0) total = 100;
            let marks = marksInput ? parseFloat(marksInput.value) : 0;
            const pct = (marks / total) * 100;
            if (percentInput) percentInput.value = isNaN(pct) ? "" : pct.toFixed(2);
            return { total, marks };
        }

        function computeGrandTotals() {
            let sumTotal = 0, sumMarks = 0;
            for (let i = 1; i <= ROWS; i++) {
                const { total, marks } = computeRow(i);
                sumTotal += total;
                sumMarks += marks;
            }
            // Grand total fields
            const grandTotalMaxEl = document.getElementById("id_total_max_marks");
            const grandTotalObtainedEl = document.getElementById("id_total_marks_obtained");
            const grandOverallPercentEl = document.getElementById("id_overall_percentage");
            const overallPct = sumTotal > 0 ? (sumMarks / sumTotal) * 100 : 0;
            if (grandTotalMaxEl) grandTotalMaxEl.value = sumTotal.toFixed(2);
            if (grandTotalObtainedEl) grandTotalObtainedEl.value = sumMarks.toFixed(2);
            if (grandOverallPercentEl) grandOverallPercentEl.value = isNaN(overallPct) ? "" : overallPct.toFixed(2);
        }

        // Add event listeners
        for (let i = 1; i <= ROWS; i++) {
            let totalInput = document.getElementById(`id_max_marks${i}`);
            let marksInput = document.getElementById(`id_marks_obtained${i}`);
            if (totalInput) totalInput.addEventListener("input", computeGrandTotals);
            if (marksInput) marksInput.addEventListener("input", computeGrandTotals);
        }
        computeGrandTotals();
    });
</script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const appFeeInput = document.getElementById("id_application_fee");
        const paymentModeSelect = document.getElementById("id_payment_mode");
        const qrSection = document.getElementById("qr-code-section");
        const qrCodeContainer = document.getElementById("qrcode");

        // === Hardcode Application Fee to ₹1000
        if (appFeeInput) {
            appFeeInput.value = 1000;
            appFeeInput.readOnly = true; // Don't use disabled; it won't submit
        }

        // === Generate UPI QR Code
        function showQRCode() {
            qrCodeContainer.innerHTML = '';

            const upiId = "9483508971@ybl";
            const payeeName = "Pinnacle School of Commerce & Management";
            const amount = 1000;

            const upiLink = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${amount}&cu=INR`;

            new QRCode(qrCodeContainer, {
                text: upiLink,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // === Show/hide QR section based on payment mode
        function toggleQRCode() {
            if (paymentModeSelect && paymentModeSelect.value.toLowerCase() === 'online') {
                qrSection.style.display = 'block';
                showQRCode();
            } else {
                qrSection.style.display = 'none';
                qrCodeContainer.innerHTML = '';
            }
        }

        // === Initialize QR visibility on load
        toggleQRCode();

        // === Listen for changes to payment mode
        if (paymentModeSelect) {
            paymentModeSelect.addEventListener('change', toggleQRCode);
        }

        // Optional: No extra validation for QR-related fields
        document.querySelector('form').addEventListener('submit', function (e) {
            // No custom QR validation needed here
        });
    });
</script>


<script>
    document.getElementById("id_pincode").addEventListener("change", function () {
        var pincode = this.value;

        if (pincode.length === 6 && /^\d+$/.test(pincode)) {
            fetch("https://api.postalpincode.in/pincode/" + pincode)
                .then(response => response.json())
                .then(data => {
                    if (data[0].Status === "Success") {
                        const postOfficeData = data[0].PostOffice[0];
                        document.getElementById("id_state").value = postOfficeData.State;

                        // Instead of District, set City/Taluk from PostOffice 'Block' or 'Name'
                        document.getElementById("id_city").value = postOfficeData.Block || postOfficeData.Name;
                    } else {
                        alert("Invalid PIN code");
                    }
                })
                .catch(err => console.log(err));
        }
    });

</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const photoInput = document.querySelector('input[name="photo"]');
        const preview = document.getElementById('photoPreview');

        photoInput.addEventListener('change', function (event) {
            const file = event.target.files[0];

            if (file) {
                // Validate file size (< 500 KB)
                if (file.size > 500 * 1024) {
                    alert("Photo size should be less than 500KB.");
                    photoInput.value = ""; // Clear the selected file
                    preview.src = "";
                    preview.style.display = 'none';
                    return;
                }

                // Display preview
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = '';
                preview.style.display = 'none';
            }
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hostelYes = document.getElementById('hostel_yes');
        const hostelNo = document.getElementById('hostel_no');
        const hostelAmountGroup = document.getElementById('hostel_amount_group');

        function toggleHostelAmount() {
            if (hostelYes.checked) {
                hostelAmountGroup.style.display = 'block';
            } else {
                hostelAmountGroup.style.display = 'none';
            }
        }

        hostelYes.addEventListener('change', toggleHostelAmount);
        hostelNo.addEventListener('change', toggleHostelAmount);

        // Run once on page load in case default is checked
        toggleHostelAmount();
    });
</script>

<style>
    body {
        background-color: #f1f1f1;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .form-card {
        background: #fff;
        padding: 40px 50px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    .form-title {
        text-align: center;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 40px;
        font-size: 24px;
        color: #343a40;
    }

    .photo-section {
        position: absolute;
        top: 82px;
        right: 50px;
        text-align: center;
    }

    .photo-label {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        display: block;
        color: #555;
    }

    .logo-container {
        margin-bottom: 10px;
    }

        .logo-container img {
            width: 705px;
            height: 123px;
            /* object-fit: contain; */
            margin-bottom: -19px;
            /*margin-left: -10px;*/
            margin-top: 9px;
        }

        .logo-container h2 {
            margin-top: 15px;
            font-size: 28px;
            font-weight: bold;
        }

    .photo-upload {
        width: 89px;
        top: 63px;
        height: 82px;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        cursor: pointer;
        background-color: #fafafa;
        font-size: 14px;
        position: relative;
        overflow: hidden;
    }

        .photo-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

    .edit-icon {
        position: absolute;
        bottom: 2px;
        right: 2px;
        font-size: 9px;
        background-color: #0274ee;
        color: white;
        padding: 1px 1px;
        border-radius: 3px;
        cursor: pointer;
    }

    /* ✅ Updated to stack fields vertically */
    .form-grid {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        width: 100%;
    }

    .form-label {
        font-weight: 500;
        margin-bottom: 6px;
        color: #333;
        font-size: 12px;
    }

    .form-group select,
    .form-group input {
        padding: 2px 10px;
        border: 1px solid #ced4da;
        border-radius: 2px;
        font-size: 14px;
        width: 100%;
        box-sizing: border-box;
    }

    .form-group.checkbox-inline {
        flex-direction: row;
        align-items: center;
        width: 50%;
    }

        .form-group.checkbox-inline .form-label {
            margin: 0;
            min-width: 186px;
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        .form-group.checkbox-inline input[type="checkbox"] {
            margin-left: 8px;
            width: 16px;
            height: 16px;
        }

    .btn {
        font-size: 14px;
        padding: 6px 12px;
        border-radius: 5px;
        margin-top: 30px;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .btn-primary {
        background-color: #800000;
        color: white;
        border: none;
    }

        .btn-primary:hover {
            background-color: #a00000;
        }



    .btn-sm {
        padding: 3px 7px;
        font-size: 14px;
    }

    .sidebar {
        width: 200px;
        height: 100vh;
        background: linear-gradient(135deg, #8B0000, #800000);
        color: white;
        padding-top: 0px;
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    }

        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 11px 8px;
            display: block;
            font-weight: 500;
        }

    .content {
        padding: 0px 74px 18px;
    }

    .error-message {
        color: red;
        font-size: 12px;
        margin-top: 2px;
        display: none;
    }
</style>

<!--<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");

        const requiredFields = [
            "id_student_name",
            "id_gender",
            "id_parent_mobile_no",
            "id_aadhar_no",
            "id_permanent_address",
            "id_emergency_contact"
        ];

        const docCheckboxNames = [
            "doc_aadhar",
            "doc_marks_card",
            "doc_caste_certificate",
            "doc_income_certificate",
            "doc_transfer",
            "doc_migration"
        ];

        form.addEventListener("submit", function (event) {
            let isValid = true;

            // Validate input/select fields
            requiredFields.forEach(function (id) {
                const input = document.getElementById(id);
                const errorId = id + "_error";

                let errorSpan = document.getElementById(errorId);
                if (!errorSpan && input) {
                    errorSpan = document.createElement("span");
                    errorSpan.id = errorId;
                    errorSpan.style.color = "red";
                    errorSpan.style.fontSize = "12px";
                    input.parentNode.appendChild(errorSpan);
                }

                if (input && input.value.trim() === "") {
                    input.style.border = "2px solid red";
                    if (errorSpan) errorSpan.textContent = "This field is required.";
                    isValid = false;
                } else if (input) {
                    input.style.border = "1px solid #ced4da";
                    if (errorSpan) errorSpan.textContent = "";
                }
            });

            // Validate document checkboxes
            const atLeastOneChecked = docCheckboxNames.some(name => {
                const checkbox = document.querySelector(input[name = "${name}"]);
                return checkbox && checkbox.checked;
            });

            let docError = document.getElementById("doc_check_error");
            if (!docError) {
                const docSection = document.querySelector("div.form-group h4:contains('Documents Submitted')")?.parentNode;
                if (docSection) {
                    docError = document.createElement("div");
                    docError.id = "doc_check_error";
                    docError.style.color = "red";
                    docError.style.fontSize = "12px";
                    docSection.appendChild(docError);
                }
            }

            if (!atLeastOneChecked && docError) {
                docError.textContent = "Please select at least one submitted document.";
                isValid = false;
            } else if (docError) {
                docError.textContent = "";
            }

            if (!isValid) {
                event.preventDefault();
                alert("Please fill all required fields.");
            }
        });
    });


    document.addEventListener('DOMContentLoaded', function () {
        // Existing Transport Logic ...
        const yes = document.getElementById('transport_yes');
        const no = document.getElementById('transport_no');
        const dropdown = document.getElementById('transport_dropdown_div');
        let hostelInput = document.getElementById('id_hostel_required') || document.querySelector('[name="hostel_required"]');

        function toggleTransportDropdown() {
            if (yes && yes.checked) {
                dropdown.style.display = 'block';
                if (hostelInput) {
                    hostelInput.disabled = true;
                    if (hostelInput.type === "checkbox" || hostelInput.type === "radio") hostelInput.checked = false;
                    else if (hostelInput.tagName === "SELECT") hostelInput.value = "";
                }
            } else if (no && no.checked) {
                dropdown.style.display = 'none';
                const select = dropdown.querySelector('select');
                if (select) select.selectedIndex = 0;
                if (hostelInput) hostelInput.disabled = false;
            }
        }

        if (yes) yes.addEventListener('change', toggleTransportDropdown);
        if (no) no.addEventListener('change', toggleTransportDropdown);
        toggleTransportDropdown();

        // ✅ Scholarship logic
        const schYes = document.getElementById('scholarship_yes');
        const schNo = document.getElementById('scholarship_no');
        const schGroup = document.getElementById('scholarship_amount_group');

        function toggleScholarshipField() {
            if (schYes && schYes.checked) {
                schGroup.style.display = 'block';
            } else {
                schGroup.style.display = 'none';
                const input = schGroup.querySelector('input');
                if (input) input.value = '';
            }
        }

        if (schYes) schYes.addEventListener('change', toggleScholarshipField);
        if (schNo) schNo.addEventListener('change', toggleScholarshipField);
        toggleScholarshipField(); // Initialize
    });
</script>-->
<!--<script>
    document.addEventListener('DOMContentLoaded', function () {
        const transportYes = document.getElementById('transport_yes');
        const transportNo = document.getElementById('transport_no');
        const transportDropdown = document.getElementById('transport_dropdown_div');
        const transportAmountGroup = document.getElementById('transport_amount_group');
        const transportAmountInput = transportAmountGroup ? transportAmountGroup.querySelector('input[name="transport_amount"]') : null;

        const hostelYes = document.getElementById('hostel_yes');
        const hostelNo = document.getElementById('hostel_no');
        const hostelAmountGroup = document.getElementById('hostel_amount_group');
        const hostelAmountInput = hostelAmountGroup ? hostelAmountGroup.querySelector('input[name="hostel_amount"]') : null;

        function toggleHostelState(disable) {
            hostelYes.disabled = disable;
            hostelNo.disabled = disable;
            if (hostelAmountInput) {
                hostelAmountInput.disabled = disable;
                if (disable) hostelAmountInput.value = '';
            }
            if (disable && hostelAmountGroup) hostelAmountGroup.style.display = 'none';
        }

        function toggleTransportState(disable) {
            transportYes.disabled = disable;
            transportNo.disabled = disable;

            if (transportDropdown) {
                transportDropdown.style.display = disable ? 'none' : (transportYes.checked ? 'block' : 'none');
                const select = transportDropdown.querySelector('select');
                if (select) {
                    select.disabled = disable;
                    if (disable) select.selectedIndex = 0;
                }
            }

            if (transportAmountGroup) {
                transportAmountGroup.style.display = disable ? 'none' : (transportYes.checked ? 'block' : 'none');
                if (transportAmountInput) {
                    transportAmountInput.disabled = disable;
                    if (disable) transportAmountInput.value = '';
                }
            }
        }

        function toggleHostelAmount() {
            if (hostelYes.checked && !hostelYes.disabled) {
                hostelAmountGroup.style.display = 'block';
            } else {
                hostelAmountGroup.style.display = 'none';
                if (hostelAmountInput) hostelAmountInput.value = '';
            }
        }

        function masterToggle() {
            if (transportYes.checked) {
                transportDropdown.style.display = 'block';
                if (transportAmountGroup) transportAmountGroup.style.display = 'block';
                toggleHostelState(true);
            } else if (transportNo.checked) {
                transportDropdown.style.display = 'none';
                if (transportAmountGroup) transportAmountGroup.style.display = 'none';
                toggleHostelState(false);
            }

            if (hostelYes.checked) {
                toggleHostelAmount();
                toggleTransportState(true);
            } else if (hostelNo.checked) {
                toggleHostelAmount();
                toggleTransportState(false);
            }
        }

        if (transportYes) transportYes.addEventListener('change', masterToggle);
        if (transportNo) transportNo.addEventListener('change', masterToggle);
        if (hostelYes) hostelYes.addEventListener('change', masterToggle);
        if (hostelNo) hostelNo.addEventListener('change', masterToggle);

        masterToggle();
    });
</script>-->


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form'); // Assumes you're using a <form>

        const validationRules = {
            aadhar: {
                fields: [
                    { id: 'id_student_aadhar_no', label: 'Student' },
                    { id: 'id_aadhar_no', label: 'Father' },
                    { id: 'id_mother_aadhar_no', label: 'Mother' }
                ],
                pattern: /^\d{12}$/,
                message: label => `Enter valid 12-digit ${label} Aadhar number.`,
            },
            phone: {
                fields: [
                    { id: 'id_parent_phone_no', label: 'Parent' },
                    { id: 'id_student_phone_no', label: 'Student' },
                    { id: 'id_emergency_contact', label: 'Emergency' },
                    { id: 'id_father_mobile_no', label: 'Father' },
                    { id: 'id_mother_phone_no', label: 'Mother' }
                ],
                pattern: /^[6-9]\d{9}$/,
                message: () => 'Enter valid 10-digit phone number starting with 6-9.',
            },
            email: {
                fields: [
                    { id: 'id_student_email', label: 'Student' },
                    { id: 'id_father_email', label: 'Father' },
                    { id: 'id_mother_email', label: 'Mother' }
                ],
                pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
                message: label => `Enter valid ${label} email (e.g., example@gmail.com).`,
            }
        };

        // Utility to show/hide error messages
        function setError(input, message) {
            const errorDiv = document.getElementById(`error_${input.id}`);
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = message ? 'block' : 'none';
            }
            input.dataset.invalid = message ? "true" : "false";
        }

        // Attach validation to each type
        Object.values(validationRules).forEach(rule => {
            rule.fields.forEach(({ id, label }) => {
                const input = document.getElementById(id);
                if (input) {
                    // Input sanitization
                    input.addEventListener('input', function () {
                        if (id.includes('aadhar')) {
                            this.value = this.value.replace(/\D/g, '').slice(0, 12);
                        } else if (id.includes('phone') || id.includes('mobile') || id.includes('contact')) {
                            this.value = this.value.replace(/\D/g, '').slice(0, 10);
                        } else if (id.includes('email')) {
                            this.value = this.value.replace(/\s/g, '');
                        }

                        const isValid = rule.pattern.test(this.value);
                        const message = !isValid && this.value !== ''
                            ? rule.message(label)
                            : '';
                        setError(this, message);
                    });

                    // Prevent leaving field if invalid
                    input.addEventListener('blur', function (e) {
                        const isValid = rule.pattern.test(this.value);
                        if (!isValid && this.value !== '') {
                            setError(this, rule.message(label));
                            setTimeout(() => this.focus(), 10); // Refocus
                        }
                    });

                    // Prevent non-digit typing for phone/aadhar
                    if (id.includes('phone') || id.includes('aadhar') || id.includes('mobile')) {
                        input.addEventListener('keypress', function (e) {
                            if (!/[0-9]/.test(e.key)) {
                                e.preventDefault();
                            }
                        });
                    }
                }
            });
        });

        // Block form submission if any field is invalid
        if (form) {
            form.addEventListener('submit', function (e) {
                const invalidFields = Array.from(form.querySelectorAll('[data-invalid="true"]'));
                if (invalidFields.length > 0) {
                    e.preventDefault();
                    invalidFields[0].focus();
                    alert("Please correct the highlighted errors before submitting the form.");
                }
            });
        }
    });
</script>

<script>
    document.getElementById('parent_mobile_no').addEventListener('input', function () {
        const phoneInput = this.value;
        const phoneError = document.getElementById('phoneError');
        const isValid = /^[6-9]\d{9}$/.test(phoneInput);

        if (!isValid && phoneInput.length > 0) {
            phoneError.style.display = 'block';
        } else {
            phoneError.style.display = 'none';
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const capitalizeInputs = document.querySelectorAll('.capitalize-first-letter');

        capitalizeInputs.forEach(function (input) {
            input.addEventListener('input', function () {
                if (this.value.length === 1) {
                    this.value = this.value.toUpperCase();
                }
            });
        });
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const capitalizeInputs = document.querySelectorAll('.capitalize-on-input');

        capitalizeInputs.forEach(function (input) {
            input.addEventListener('input', function () {
                if (this.value.length === 1) {
                    this.value = this.value.toUpperCase();
                }
            });
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.querySelector(".capitalize-name");

        if (input) {
            input.addEventListener("input", function () {
                let value = input.value;

                if (value.length === 1) {
                    // Force first character to be uppercase
                    input.value = value.toUpperCase();
                } else if (value.length > 1) {
                    // Keep first letter uppercase, rest as typed
                    input.value = value.charAt(0).toUpperCase() + value.slice(1);
                }
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        const pincodeInput = document.getElementById('id_pincode');
        const cityInput = document.getElementById('id_city');
        const stateInput = document.getElementById('id_state');

        function fetchPincodeData() {
            const pincode = pincodeInput.value.trim();
            if (pincode.length === 6 && /^\d+$/.test(pincode)) {
                fetch(`https://api.postalpincode.in/pincode/${pincode}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data[0].Status === "Success" && data[0].PostOffice && data[0].PostOffice.length > 0) {
                            const postOffice = data[0].PostOffice[0];
                            cityInput.value = postOffice.Block && postOffice.Block !== "NA"
                                ? postOffice.Block
                                : postOffice.District || '';
                            stateInput.value = postOffice.State || '';
                        } else {
                            // Optionally clear or show error if pincode not found
                            // cityInput.value = "";
                            // stateInput.value = "";
                            // alert("Invalid or unknown pincode.");
                        }
                    })
                    .catch(err => {
                        // Optionally handle API error
                        // alert("Unable to fetch city/state for pincode.");
                    });
            }
        }

        if (pincodeInput && cityInput && stateInput) {
            // On blur (when field loses focus)
            pincodeInput.addEventListener('blur', function () {
                fetchPincodeData();
            });

            // On Enter key
            pincodeInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    fetchPincodeData();
                }
            });
        }
    });

</script>

<!--<script>
    $('#id_course_type, #id_course').change(function () {
        $.get('/get-course-fees/', {
            course_type_id: $('#id_course_type').val(),
            course_id: $('#id_course').val()
        }, function (data) {
            for (let k in data) {
                $('#id_' + k).val(data[k]);
            }
        });
    });
</script>-->
    {% endblock %}