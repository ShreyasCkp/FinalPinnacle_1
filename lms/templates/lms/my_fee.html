{% extends 'lms/student_layout.html' %}
{% block title %}My Fees & Payments{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="fw-bold mb-4 text-center">My Fees & Payments</h2>

    <!-- Dashboard Cards -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card shadow-sm h-100 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Total Fees</h6>
                    <h3 class="fw-bold">{{ total_fees }}</h3>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card shadow-sm h-100 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Collected</h6>
                    <h3 class="fw-bold">{{ collected }}</h3>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card shadow-sm h-100 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Pending</h6>
                    <h3 class="fw-bold">{{ pending }}</h3>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card shadow-sm h-100 text-center">
                <div class="card-body">
                    <h6 class="text-muted">Overdue</h6>
                    <h3 class="fw-bold">{{ overdue }}</h3>
                    {% if overdue_fee_types %}
                    <small class="d-block mt-2 text-danger">
                        Overdue Fee Types:
                        <ul class="list-unstyled mb-0">
                            {% for fee_type in overdue_fee_types %}
                            <li>{{ fee_type }}</li>
                            {% endfor %}
                        </ul>
                    </small>
                    {% else %}
                    <small class="d-block mt-2 text-success">No overdue fees</small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Fees Details Table -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-center mb-3">Fees Details</h5>
            <div class="table-responsive">
                <table class="table table-bordered text-center">
                    <thead class="table-dark">
                        <tr>
                            <th>Fee Type</th>
                            <th>Amount</th>
                            <th>Paid Amount</th>
                            <th>Balance Amount</th>
                            <th>Discount</th>
                            <th>Due Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for fee in fee_collections %}
                        <tr>
                            <td>{{ fee.fee_type.name }}</td>
                            <td>{{ fee.amount }}</td>
                            <td>{{ fee.paid_amount }}</td>
                            <td>{{ fee.balance_amount }}</td>
                            <td>{{ fee.applied_discount }}</td>
                            <td>{{ fee.due_date|date:"M d, Y" }}</td>
                            <td>{{ fee.status }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7">No fee records found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Fee Receipts Table -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-center mb-3">Download Fee Receipts</h5>
            <div class="table-responsive">
                <table class="table table-bordered text-center">
                    <thead class="table-dark">
                        <tr>
                            <th>Receipt No</th>
                            <th>Receipt Date</th>
                            <th>Fee Type(s)</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for receipt in daily_receipts %}
                        <tr>
                            <td>{{ receipt.receipt_no }}</td>
                            <td>{{ receipt.receipt_date|date:"M. d, Y" }}</td>
                            <td>{{ receipt.fee_types }}</td>
                            <td>
                                <a class="text-maroon" href="{% url 'student_fee_receipt' receipt.admission_no|urlencode receipt.receipt_no %}">
                                    Receipt PDF
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="4">No daily receipts available.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f7f8f8;
    }

    .fw-bold { color: #800000; }
    .text-maroon { color: #800000; }
    .text-maroon:hover { text-decoration: underline; }

    .card { border-radius: 12px; transition: transform 0.2s ease-in-out; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 0 15px rgba(0,0,0,0.1); }

    table th, table td { font-size: 0.8rem; vertical-align: middle; }
    @media (max-width: 768px) {
        table th, table td { font-size: 0.7rem; padding: 0.25rem; }
        .fw-bold { font-size: 1.2rem; }
    }
</style>
{% endblock %}
