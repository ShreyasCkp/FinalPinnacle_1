{% extends 'lms/employee_layout.html' %}
{% block title %}View Attendance{% endblock %}
{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    /* === Container & Layout === */
    .container {
        padding: 16px;
        margin: 0 auto;
    }

    h5.mb-3 {
        font-weight: 600;
        color: #800;
        font-size: 20px;
        text-align: center;
        margin-bottom: 16px;
    }

    /* === Dropdowns === */
    .dropdown form {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .form-select, .form-selectss {
        background-color: #800;
        color: #fff;
        border-radius: 5px;
        text-align: center;
        padding: 4px 6px;
        border: 1px solid #800;
        font-size: 14px;
    }

    /* === Calendar === */
    .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        font-weight: 600;
        text-align: center;
        margin-bottom: 6px;
        color: #495057;
        font-size: 13px;
    }

    .calendar-container {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
    }

    .calendar-day {
        min-height: 70px;
        border: 1px solid #800; 
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        cursor: default;
        position: relative;
        overflow: hidden;
        background: transparent;
        transition: transform 0.2s, box-shadow 0.2s;
        padding: 4px 2px;
    }

    .calendar-day .fill {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 10%;
        border-radius: 8px 8px 0 0;
        z-index: 0;
    }

    .present .fill { background-color: darkgreen; }
    .absent .fill { background-color: crimson; }
    .late .fill { background-color: #ffa500; }
    .leave .fill { background-color: #5A5A5A; }
    .holiday .fill { background-color: black; }

    .day-number, .day-status { position: relative; z-index: 1; font-size: 12px; text-align: center; }
    .day-status { margin-top: 4px; }

    .empty-day { min-height: 70px; }

    /* === Legend === */
    .attendance-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin: 20px 0;
        justify-content: center;
        font-size: 14px;
        font-weight: 500;
    }

    .attendance-legend .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .color-box {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        display: inline-block;
        border: 1px solid #333;
    }

    .color-present { background-color: darkgreen; }
    .color-absent { background-color: crimson; }
    .color-late { background-color: #ffa500; }
    .color-leave { background-color: #5A5A5A; }
    .color-holiday { background-color: black; }

    /* === Responsive adjustments === */
    @media (max-width: 768px) {
        .calendar-day { min-height: 60px; font-size: 11px; }
        .calendar-weekdays { font-size: 11px; }
        .form-select, .form-selectss { width: 100%; font-size: 13px; }
        .dropdown form { flex-direction: column; gap: 10px; }
        .attendance-legend { flex-direction: column; gap: 8px; }
    }

    @media (max-width: 480px) {
        .calendar-day { min-height: 55px; font-size: 10px; }
        .day-status { font-size: 10px; }
    }
</style>

<div class="container mt-4">
    <h5 class="mb-3">View Attendance</h5>

    <!-- Month & Year Selector -->
    <div class="dropdown">
        <form method="get">
            <select name="month" class="form-select" onchange="this.form.submit()">
                {% for m in months %}
                    <option value="{{ m.num }}" {% if m.num == selected_month %}selected{% endif %}>{{ m.name }}</option>
                {% endfor %}
            </select>
            <select name="year" class="form-selectss" onchange="this.form.submit()">
                {% for y in year_list %}
                    <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- Weekday Headers -->
    <div class="calendar-weekdays">
        <div>Mon</div>
        <div>Tue</div>
        <div>Wed</div>
        <div>Thu</div>
        <div>Fri</div>
        <div>Sat</div>
        <div>Sun</div>
    </div>

    <!-- Calendar Days -->
    <div class="calendar-container">
        {% for i in calendar_data.0.date.weekday|add:"0"|make_list %}
            <div class="empty-day"></div>
        {% endfor %}

        {% for day in calendar_data %}
        <div class="calendar-day
            {% if day.status == 'Present' %}present
            {% elif day.status == 'Late' %}late
            {% elif day.status == 'Absent' %}absent
            {% elif day.status == 'Leave' %}leave
            {% elif day.status == 'Holiday' %}holiday{% endif %}">
            <div class="fill"></div>
            <div class="day-number">{{ day.date.day }}</div>
            <div class="day-status">
                {% if day.status == 'Present' %}‚úÖ Present
                {% elif day.status == 'Late' %}‚è∞ Late
                {% elif day.status == 'Absent' %}‚ùå Absent
                {% elif day.status == 'Leave' %}üìù {{ day.leave_type }}
                {% elif day.status == 'Holiday' %}üéâ {{ day.leave_type }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Legend -->
    <div class="attendance-legend">
        <div class="legend-item"><span class="color-box color-present"></span> Present</div>
        <div class="legend-item"><span class="color-box color-absent"></span> Absent</div>
        <div class="legend-item"><span class="color-box color-late"></span> Late</div>
        <div class="legend-item"><span class="color-box color-leave"></span> Leave</div>
        <div class="legend-item"><span class="color-box color-holiday"></span> Holiday</div>
    </div>
</div>

{% endblock %}
